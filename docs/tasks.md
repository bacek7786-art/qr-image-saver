# 実装計画: QR Image Saver

## 概要

静的HTMLページとして、複数のQRコード画像を表示・保存する機能を実装します。すべてのCSS・JavaScriptは単一のindex.htmlファイルに埋め込み、Pages Dropなどの静的ホスティングサービスで即座に動作するようにします。

## タスク

- [ ] 1. 基本HTML構造とCSSスタイリングの実装
  - index.htmlファイルを作成し、セマンティックなHTML5マークアップを実装
  - CSS変数を使用したスタイルシステムを実装（背景、カード、ボタン、テキストなど）
  - レスポンシブデザイン用のメディアクエリを実装（スマートフォン、タブレット、デスクトップ）
  - ヘッダー（タイトル・サブタイトル）、QRリストコンテナ、フッター、会社情報セクションのマークアップ
  - _要件: 1.1, 2.1, 2.2, 2.3, 2.5, 2.6, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 1.1 基本構造のユニットテストを作成
  - ヘッダーテキストの存在確認
  - フッターボタンの存在確認
  - 会社情報テキストの存在確認
  - _要件: 2.3, 2.5, 2.6_

- [ ] 1.2 レスポンシブデザインのユニットテストを作成
  - スマートフォン幅（375px）でのカード幅確認
  - デスクトップ幅（1200px）でのカード最大幅確認
  - _要件: 3.1, 3.3_

- [ ] 2. DownloadManagerクラスの実装
  - [ ] 2.1 DownloadManagerクラスの基本構造を作成
    - コンストラクタ（isDownloadingフラグ、downloadDelay設定）
    - supportsDownloadAttribute()メソッド（download属性のサポート検出）
    - sleep()メソッド（遅延処理用）
    - _要件: 5.2, 5.4_

  - [ ] 2.2 downloadSingle()メソッドを実装
    - download属性サポート時: 一時的なアンカー要素を作成してクリック
    - 非サポート時: window.openでフォールバック
    - URL検証とエラーハンドリング
    - _要件: 5.1, 5.2, 5.3, 5.4_

  - [ ] 2.3 downloadSingle()のプロパティテストを作成
    - **プロパティ7: 個別ダウンロードのトリガー**
    - **検証: 要件 5.1**

  - [ ] 2.4 download属性フォールバックのユニットテストを作成
    - download属性非対応環境でのwindow.open呼び出し確認
    - _要件: 5.4_

  - [ ] 2.5 downloadAll()メソッドを実装
    - 並行実行防止（isDownloadingフラグチェック）
    - 配列の各アイテムに対してdownloadSingle()を順次呼び出し
    - 各ダウンロード間で250-400ms待機
    - _要件: 6.1, 6.2, 6.3, 6.4_

  - [ ] 2.6 downloadAll()のプロパティテストを作成
    - **プロパティ9: 一括ダウンロードの完全性**
    - **プロパティ10: ダウンロード間隔の遵守**
    - **プロパティ11: ダウンロード順序の保持**
    - **プロパティ12: 一括ダウンロードの並行実行防止**
    - **検証: 要件 6.1, 6.2, 6.3, 6.4**

- [ ] 3. QRデータ管理とDOM生成の実装
  - [ ] 3.1 QRデータ配列を定義
    - 4つのウォレットQR画像URL（BTC, BCH, ETH, XRP）
    - 各アイテムにurl、filenameプロパティを含む
    - _要件: 7.1_

  - [ ] 3.2 renderQRList()関数を実装
    - QRデータ配列からDOM要素を動的生成
    - 各行にアイコン枠、URLリンク、保存ボタンを含む
    - URLリンクにtarget="_blank"とrel="noopener"を設定
    - 無効なURLの場合は保存ボタンを無効化
    - _要件: 2.4, 4.1, 4.2, 4.3, 5.5, 7.1, 7.2_

  - [ ] 3.3 renderQRList()のプロパティテストを作成
    - **プロパティ1: URL形式の検証**
    - **プロパティ2: QRリスト行の構造完全性**
    - **プロパティ6: 外部リンクのセキュリティ属性**
    - **プロパティ8: 無効URLでのボタン無効化**
    - **検証: 要件 1.3, 2.4, 4.2, 4.3, 5.5**

  - [ ] 3.4 データソースの柔軟性ユニットテストを作成
    - JavaScript配列からのレンダリング確認
    - HTMLマークアップからのレンダリング確認（オプション）
    - _要件: 7.1, 7.2_

- [ ] 4. イベントハンドラーとアプリケーション初期化
  - [ ] 4.1 DOMContentLoadedイベントハンドラーを実装
    - DownloadManagerインスタンスを作成
    - renderQRList()を呼び出してQRリストを生成
    - 個別保存ボタンにクリックイベントを設定
    - 「まとめて保存」ボタンにクリックイベントを設定
    - _要件: 5.1, 6.1_

  - [ ] 4.2 イベントハンドラーのユニットテストを作成
    - 個別保存ボタンクリック時のdownloadSingle呼び出し確認
    - まとめて保存ボタンクリック時のdownloadAll呼び出し確認
    - _要件: 5.1, 6.1_

- [ ] 5. アクセシビリティとスタイルの最終調整
  - [ ] 5.1 キーボードアクセシビリティを確認・調整
    - すべてのボタンとリンクがキーボードでフォーカス可能
    - タブ順序が論理的
    - _要件: 9.1, 9.4_

  - [ ] 5.2 レスポンシブスタイルの最終確認
    - URL表示のtext-overflow: ellipsis設定
    - 保存ボタンの最小高さ44px確認
    - リスト行の最小高さ56px確認
    - 360px以下での2行表示フォールバック（オプション）
    - _要件: 3.4, 3.5, 3.6, 3.7_

  - [ ] 5.3 アクセシビリティとスタイルのプロパティテストを作成
    - **プロパティ3: URL表示のテキストオーバーフロー処理**
    - **プロパティ4: 保存ボタンの最小高さ保証**
    - **プロパティ5: リスト行の最小高さ保証**
    - **プロパティ13: キーボードアクセシビリティ**
    - **検証: 要件 3.4, 3.5, 3.6, 9.1**

- [ ] 6. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる。

- [ ] 7. エラーハンドリングとエッジケースの実装
  - [ ] 7.1 URL検証関数を実装
    - 空または無効なURLのチェック
    - 絶対URL（https://）または相対パス（./）の検証
    - _要件: 1.3, 5.5_

  - [ ] 7.2 エラーハンドリングを追加
    - 無効なURLに対するコンソール警告
    - ダウンロード失敗時のエラーログ
    - 一括ダウンロード中断時のフラグリセット
    - _要件: 5.5_

  - [ ] 7.3 エラーケースのユニットテストを作成
    - 空のQRデータ配列
    - 単一アイテムのQRデータ
    - 非常に長いURL
    - 無効なURL形式
    - ダウンロード中の重複クリック
    - _要件: 5.5, 6.4_

- [ ] 8. 最終統合とデプロイ準備
  - [ ] 8.1 すべてのコンポーネントを統合
    - HTML、CSS、JavaScriptが単一ファイルに正しく統合されているか確認
    - 外部依存関係がないことを確認
    - _要件: 1.1, 10.1_

  - [ ] 8.2 実際のブラウザでの動作確認
    - Chrome/Edge（デスクトップ）
    - Safari（iOS）- download属性フォールバック確認
    - 各種画面サイズでのレスポンシブ動作確認
    - _要件: 1.4, 3.1, 3.2, 3.3, 5.4_

  - [ ] 8.3 デプロイメントパッケージの準備
    - index.htmlファイルの最終確認
    - 画像URLが正しく設定されているか確認
    - Pages Dropへのアップロード手順をドキュメント化（README作成）
    - _要件: 10.1, 10.2, 10.3_

- [ ] 9. 最終チェックポイント - すべてのテストが通過し、デプロイ準備完了
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる。

## 注意事項

- 各タスクは特定の要件を参照してトレーサビリティを確保
- チェックポイントで段階的な検証を実施
- プロパティテストは普遍的な正確性プロパティを検証
- ユニットテストは特定の例とエッジケースを検証
